(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["home"],{"1c17":function(e,t,n){"use strict";n("d227")},"264d":function(e,t,n){"use strict";n("568d")},"568d":function(e,t,n){},"7abe":function(e,t,n){"use strict";n.r(t);var o=n("7a23");class c{}var s=function(e,t,n){const{size:o,color:c}=n;if(2===e.length)t.beginPath(),t.arc(e[0],e[1],o/2,0,2*Math.PI),t.closePath(),t.fillStyle=c,t.fill();else{t.beginPath(),t.moveTo(e[0],e[1]);for(let n=2;n<e.length;n+=2)t.lineTo(e[n],e[n+1]);t.strokeStyle=c,t.lineWidth=o,t.lineCap="round",t.lineJoin="round",t.stroke(),t.closePath()}},i=function(e,t,n){if(e.length<4)return;const{size:o,force:c}=n;t.globalCompositeOperation="destination-out",t.beginPath(),t.moveTo(e[0],e[1]);for(let s=2;s<e.length;s+=2)t.lineTo(e[s],e[s+1]);t.strokeStyle=`rgba(255, 255, 255, ${c})`,t.lineWidth=o,t.lineCap="round",t.lineJoin="round",t.stroke(),t.closePath()};class a extends c{constructor(e){super(),this.type="Path",this.data=[],this.painter=e}get boundingBox(){if(this._boundingBox)return this._boundingBox;const e=this.painter.size;let t=this.data[0],n=this.data[1],o=this.data[0],c=this.data[1];for(let s=2;s<this.data.length;s+=2){const e=this.data[s],i=this.data[s+1];e<t&&(t=e),e>o&&(o=e),i<n&&(n=i),i>c&&(c=i)}return this._boundingBox={x:t-e,y:n-e,w:o-t+2*e,h:c-n+2*e},this._boundingBox}draw(e){const{type:t,size:n,color:o,force:c}=this.painter;if("pen"===t){const t=o;s(this.data,e,{size:n,color:t})}else{const t=c;i(this.data,e,{size:n,force:t})}}}class r{constructor(e){this.data=[],this.index=-1,this.cvs=e}get head(){return this.data.slice(0,this.index+1)}reset(){this.data=[],this.index=-1}undo(){-1!==this.index&&(this.index--,this.cvs.layers=[...this.head],this.cvs.refreshImage())}redo(){this.index!==this.data.length-1&&(this.index++,this.cvs.layers=[...this.head],this.cvs.refreshImage())}add(e){this.data.splice(this.index+1),this.data.push(e),this.cvs.layers.push(e),this.cvs.refreshImage(),this.index++}}var l=function(e){const t=t=>{t.preventDefault(),e.emit("touchstart",t)},n=t=>{t.preventDefault(),e.emit("touchmove",t)},o=t=>{t.preventDefault(),e.emit("touchend",t)};e.dom.addEventListener("touchstart",t),e.dom.addEventListener("touchmove",n),e.dom.addEventListener("touchend",o)};class h{constructor(e,t){this.x=e,this.y=t}matrix(e,t,n,o,c,s){const i=this.x,a=this.y;return this.x=e*i+t*a+n,this.y=o*i+c*a+s,this}translate(e,t){return this.x+=e,this.y+=t,this}move(e,t){return this.translate(e,t)}rotate(e){const t=Math.cos(e),n=Math.sin(e);return this.matrix(t,-n,0,n,t,0),this}scale(e,t){return this.x*=e,this.y*=t,this}skewX(e){e=e/180*Math.PI;const t=Math.tan(e);return this.matrix(1,t,0,0,1,0)}skewY(e){e=e/180*Math.PI;const t=Math.tan(e);return this.matrix(1,0,0,t,1,0)}norm(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalVector(){const e=this.norm();return 0===e?this:new h(this.y/e,-this.x/e)}unit(){const e=this.norm();return 0===e?this:new h(this.x/e,this.y/e)}angle(e=1,t=0){const n=this.norm(),o=Math.sqrt(e*e+t*t);if(n*o===0)return 0;const c=this.dot(e,t),s=Math.max(-1,Math.min(1,c/n/o));return Math.acos(s)}dot(e,t){return this.x*e+this.y*t}cross(e,t){return this.x*t-this.y*e}flip(e,t,n,o){const{x:c,y:s}=this,[i,a]=[c-e,s-t],[r,l]=[n-e,o-t];if(0!==r||0!==l){const n=r*r+l*l;this.x=(i*(r*r-l*l)+2*a*r*l)/n+e,this.y=(a*(l*l-r*r)+2*i*r*l)/n+t}return this}}class d{constructor(){this.x=0,this.y=0,this.scale=1,this.rotation=0,this.mode="default",this.backgroundColor="rgba(255, 255, 255, 1)",this.width=400,this.height=300,this.layers=[],this.activePath=null,this.img=null,this.handlers={},this.dom=this.initDom(),this.ctx=this.dom.getContext("2d",{willReadFrequently:!0}),this.activeCanvas=document.createElement("canvas"),this.activeCanvas.width=this.width,this.activeCanvas.height=this.height,this.activeCtx=this.activeCanvas.getContext("2d"),document.body.appendChild(this.activeCanvas),l(this)}initDom(){const e=document.createElement("canvas");return e.width=this.width,e.height=this.height,Object.assign(e.style,{width:this.width+"px",height:this.height+"px",verticalAlign:"middle"}),e}mount(e){e.appendChild(this.dom);const t=e.offsetWidth,n=e.offsetHeight;this.resize(t,n)}resize(e,t){this.width=e,this.height=t,this.dom.width=e,this.dom.height=t,this.dom.style.width=e+"px",this.dom.style.height=t+"px",this.activeCanvas.width=e,this.activeCanvas.height=t,this.activeCanvas.style.width=e+"px",this.activeCanvas.style.height=t+"px"}refreshImage(){const{x:e,y:t,w:n,h:o}=this.getBoundingBox();if(0===n||0===o)return void(this.img=null);const c=document.createElement("canvas");c.width=n,c.height=o;const s=c.getContext("2d");s.translate(-e,-t),this.layers.forEach(e=>{s.save(),e.draw(s),s.restore()}),this.img={x:e,y:t,w:n,h:o,img:c}}getBoundingBox(){if(0===this.layers.length)return{x:0,y:0,w:0,h:0};{let e=1;const t=this.layers.map(t=>{var n;const o=(null===t||void 0===t||null===(n=t.painter)||void 0===n?void 0:n.size)||0;return o>e&&(e=o),t.boundingBox});let{x:n,y:o}=t[0];const{w:c,h:s}=t[0];let i=n+c,a=o+s;for(let r=1;r<t.length;r++){const{x:e,y:c,w:s,h:l}=t[r];e<n&&(n=e),c<o&&(o=c),e+s>i&&(i=e+s),c+l>a&&(a=c+l)}return{x:n-e,y:o-e,w:i-n+e,h:a-o+e}}}drawFrame(){const{x:e,y:t,scale:n,width:o,height:c,activeCtx:s,rotation:i,backgroundColor:a,img:r}=this;s.clearRect(0,0,o,c),s.save(),s.translate(e,t),s.scale(n,n),s.rotate(i),this.layers.forEach(e=>{s.save(),e.draw(s),s.restore()}),this.activePath&&this.activePath.draw(s),s.restore(),this.ctx.clearRect(0,0,o,c),this.ctx.fillStyle=a,this.ctx.fillRect(0,0,o,c),this.ctx.drawImage(this.activeCanvas,0,0,o,c)}getRelativeCoord(e,t){return new h(e,t).translate(-this.x,-this.y).scale(1/this.scale,1/this.scale).rotate(-this.rotation)}on(e,t){this.handlers[e]||(this.handlers[e]=[]);const n=this.handlers[e];n.push(t)}off(e,t){if(!this.handlers[e])return;if(!t)return void(this.handlers[e]=[]);const n=this.handlers[e],o=n.indexOf(t);o>-1&&n.splice(o,1)}emit(e,...t){const n=this.handlers[e];n&&0!==n.length&&n.forEach(e=>e(...t))}}const u=new d,p=new r(u),m=Object(o["reactive"])({mode:"pen",buket:!1,pen:{color:"#000",size:1},eraser:{size:1,force:1}}),b=["onClick"];var v=Object(o["defineComponent"])({__name:"index",setup(e){const t=[{name:"pen",icon:"icon-pen1"},{name:"eraser",icon:"icon-eraser"}],n=e=>{m.mode=e};return(e,c)=>(Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(t,(e,t)=>Object(o["createElementVNode"])("span",{key:t,class:Object(o["normalizeClass"])(["iconfont",e.name===Object(o["unref"])(m).mode?"is-active "+e.icon:e.icon]),onClick:t=>n(e.name)},null,10,b)),64))}});const j=v;var f=j;const O=e=>(Object(o["pushScopeId"])("data-v-2845444e"),e=e(),Object(o["popScopeId"])(),e),g={class:"panel"},x=O(()=>Object(o["createElementVNode"])("div",{class:"panel-header"}," 粗细 ",-1)),w={class:"panel-body"},y={class:"size-wrap flex"},C=["onClick"],k={class:"panel-body"};var E=Object(o["defineComponent"])({__name:"index",setup(e){const t=[1,5,10,15,20,25],n=Object(o["ref"])("pen"===m.mode?m.pen.size:m.eraser.size),c=e=>{n.value=e,"pen"===m.mode?m.pen.size=e:m.eraser.size=e};return(e,s)=>{const i=Object(o["resolveComponent"])("el-slider");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",g,[x,Object(o["createElementVNode"])("div",w,[Object(o["createElementVNode"])("div",y,[(Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(t,e=>Object(o["createElementVNode"])("span",{class:"size",key:e,onClick:t=>c(e)},[Object(o["createElementVNode"])("span",{class:"size-inner",style:Object(o["normalizeStyle"])({width:e+"px",height:e+"px"})},null,4)],8,C)),64))])]),Object(o["createElementVNode"])("div",k,[Object(o["createVNode"])(i,{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=e=>n.value=e),onChange:c,min:1,max:50},null,8,["modelValue"])])])}}}),V=(n("9ce1"),n("6b0d")),_=n.n(V);const B=_()(E,[["__scopeId","data-v-2845444e"]]);var N=B;const z=e=>(Object(o["pushScopeId"])("data-v-92ac15c6"),e=e(),Object(o["popScopeId"])(),e),I=z(()=>Object(o["createElementVNode"])("span",{class:"sizeicon"},null,-1)),M=[I];var P=Object(o["defineComponent"])({__name:"index",setup(e){const t=Object(o["inject"])("openDrawer");return(e,n)=>(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{class:"iconfont",onClick:n[0]||(n[0]=e=>Object(o["unref"])(t)(N))},M))}});n("920e");const R=_()(P,[["__scopeId","data-v-92ac15c6"]]);var S=R,D=Object(o["defineComponent"])({__name:"index",setup(e){const t=Object(o["ref"])([]),n=e=>{null===e&&(e=m.pen.color="rgba(0, 0, 0, 1)"),t.value.includes(e)||t.value.unshift(e)},c=e=>{if(e.touches.length>1)return;let t=e.touches[0].pageX,n=e.touches[0].pageY;const o=e=>{t=e.touches[0].pageX,n=e.touches[0].pageY},c=()=>{window.removeEventListener("touchend",c),window.removeEventListener("touchmove",o),document.elementFromPoint(t,n)===u.dom&&u.emit("drop",{x:t,y:n})};window.addEventListener("touchmove",o),window.addEventListener("touchend",c)};return(e,s)=>{const i=Object(o["resolveComponent"])("el-color-picker");return Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{onTouchstart:c},[Object(o["createVNode"])(i,{class:"color-picker",modelValue:Object(o["unref"])(m).pen.color,"onUpdate:modelValue":s[0]||(s[0]=e=>Object(o["unref"])(m).pen.color=e),onChange:n,"show-alpha":"",predefine:t.value},null,8,["modelValue","predefine"])],32)}}});const F=D;var L=F,T=Object(o["defineComponent"])({__name:"index",setup(e){const t=()=>p.undo();return(e,n)=>(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{class:"iconfont icon-Undo",onClick:t}))}});const X=T;var Y=X,q=Object(o["defineComponent"])({__name:"index",setup(e){const t=()=>p.redo();return(e,n)=>(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{class:"iconfont icon-Redo",onClick:t}))}});const $=q;var J=$;const U=Object(o["createElementVNode"])("span",{class:"iconfont icon-delete"},null,-1),W=Object(o["createTextVNode"])(" 清除屏幕 "),A=[U,W];var G=Object(o["defineComponent"])({__name:"index",setup(e){const t=()=>{u.layers=[],p.reset(),u.refreshImage()};return(e,n)=>(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{style:{color:"red"},onClick:t},A))}});const H=G;var K=H;const Q=e=>(Object(o["pushScopeId"])("data-v-1de6035a"),e=e(),Object(o["popScopeId"])(),e),Z=Q(()=>Object(o["createElementVNode"])("div",null,"长按保存图片",-1)),ee={class:"img-wrap"},te=["src"];var ne=Object(o["defineComponent"])({__name:"index",setup(e){const t=Object(o["inject"])("cvs"),n=t.dom.toDataURL();return(e,t)=>(Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],null,[Z,Object(o["createElementVNode"])("div",ee,[Object(o["createElementVNode"])("img",{src:Object(o["unref"])(n)},null,8,te)])],64))}});n("264d");const oe=_()(ne,[["__scopeId","data-v-1de6035a"]]);var ce=oe;const se=Object(o["createElementVNode"])("span",{class:"iconfont icon-download"},null,-1),ie=Object(o["createTextVNode"])(" 导出图片 "),ae=[se,ie];var re=Object(o["defineComponent"])({__name:"index",setup(e){const t=Object(o["inject"])("openDrawer");return(e,n)=>(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{onClick:n[0]||(n[0]=e=>Object(o["unref"])(t)(ce))},ae))}});const le=re;var he=le;const de=Object(o["createElementVNode"])("span",{class:"iconfont icon-marquee"},null,-1),ue=Object(o["createTextVNode"])(" 重置视口 "),pe=[de,ue];var me=Object(o["defineComponent"])({__name:"index",setup(e){const t=()=>{u.x=0,u.y=0,u.scale=1,u.rotation=0};return(e,n)=>(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{onClick:t},pe))}});const be=me;var ve=be;const je=Object(o["createElementVNode"])("span",{class:"iconfont icon-menu"},null,-1);var fe=Object(o["defineComponent"])({__name:"index",setup(e){return(e,t)=>{const n=Object(o["resolveComponent"])("el-dropdown-item"),c=Object(o["resolveComponent"])("el-dropdown-menu"),s=Object(o["resolveComponent"])("el-dropdown");return Object(o["openBlock"])(),Object(o["createBlock"])(s,{placement:"top"},{dropdown:Object(o["withCtx"])(()=>[Object(o["createVNode"])(c,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(n,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(ve)]),_:1}),Object(o["createVNode"])(n,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(he)]),_:1}),Object(o["createVNode"])(n,{divided:""},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(K)]),_:1})]),_:1})]),default:Object(o["withCtx"])(()=>[je]),_:1})}}});const Oe=fe;var ge=Oe;const xe={class:"menu"};var we=Object(o["defineComponent"])({__name:"index",setup(e){return(e,t)=>(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",xe,[Object(o["createVNode"])(f),Object(o["createVNode"])(S),Object(o["createVNode"])(L),Object(o["createVNode"])(Y),Object(o["createVNode"])(J),Object(o["createVNode"])(ge)]))}});n("1c17"),n("a720");const ye=_()(we,[["__scopeId","data-v-347cc8d6"]]);var Ce=ye;let ke,Ee,Ve,_e;var Be=function(e){e.on("touchstart",e=>{const t=e;2===t.touches.length&&(ke=t.touches[0].pageX,Ve=t.touches[0].pageY,Ee=t.touches[1].pageX,_e=t.touches[1].pageY)}),e.on("touchmove",t=>{const n=t;if(2===n.touches.length){const t=n.touches[0].pageX,o=n.touches[0].pageY,c=n.touches[1].pageX,s=n.touches[1].pageY,i=new h(Ee-ke,_e-Ve),a=new h(c-t,s-o),r=i.angle(a.x,a.y),l=i.cross(a.x,a.y)>0?r:-r,d=a.norm()/i.norm(),u=e.getRelativeCoord((ke+Ee)/2,(Ve+_e)/2);e.rotation+=l,e.scale*=d,u.rotate(e.rotation).scale(e.scale,e.scale);const p=new h((t+c)/2,(o+s)/2).move(-u.x,-u.y);e.x=p.x,e.y=p.y,ke=t,Ee=c,Ve=o,_e=s}})};let Ne=null,ze=!1;const Ie=45;var Me=function(e){e.on("touchstart",t=>{const n=t;if(1===n.touches.length){const t="pen"===m.mode?{type:"pen",...m.pen}:{type:"eraser",...m.eraser},o=e.getRelativeCoord(n.touches[0].pageX,n.touches[0].pageY-Ie);Ne=new a(t),Ne.data.push(o.x,o.y)}}),e.on("touchmove",t=>{const n=t;if(1===n.touches.length&&Ne){const t=e.getRelativeCoord(n.touches[0].pageX,n.touches[0].pageY-Ie);Ne.data.push(t.x,t.y),ze||(e.activePath=Ne,ze=!0)}}),e.on("touchend",()=>{ze&&p.add(Ne),ze=!1,e.activePath=null,Ne=null})};function Pe(e,t,n,o=80){const c=(e,t,n)=>{let o=0;for(let c=0;c<4;c++)if(o+=Math.abs(e[c]-t[c]),o>n)return!1;return!0},s=e.data,i=e.width,a=e.height,r=new Set,l=[[t,n]],h=4*(n*i+t),d=[s[h],s[h+1],s[h+2],s[h+3]],u=(e,t)=>{if(r.has(`${e},${t}`))return;r.add(`${e},${t}`);const n=4*(t*i+e);c(d,[s[n],s[n+1],s[n+2],s[n+3]],o)&&l.push([e,t])};let p=0;while(p<l.length){const[e,t]=l[p];t>0&&u(e,t-1),e>0&&u(e-1,t),e<i-1&&u(e+1,t),t<a-1&&u(e,t+1),p++}return l}class Re extends c{constructor(e,t,n,o,c,s){super(),this.type="Rasterized",this.x=0,this.y=0,this.width=100,this.height=100,this.rotation=0,this.img=e,this.x=t,this.y=n,this.width=o,this.height=c,this.rotation=s}get boundingBox(){const{x:e,y:t,width:n,height:o,rotation:c}=this,s=[[n,0],[n,o],[0,o]];let i=0,a=0,r=0,l=0;return s.forEach(e=>{const{x:t,y:n}=new h(e[0],e[1]).rotate(c);t<i&&(i=t),t>r&&(r=t),n<a&&(a=n),n>l&&(l=n)}),{x:i+e,y:a+t,w:r-i,h:l-a}}draw(e){e.translate(this.x,this.y),e.rotate(this.rotation),e.drawImage(this.img,0,0,this.width,this.height)}}let Se,De;const Fe=45;var Le=function(e){e.on("drop",t=>{const n=t;Se=Math.floor(n.x),De=Math.floor(n.y-Fe);const o=e.ctx.getImageData(0,0,e.width,e.height),c=Pe(o,Se,De,50);let s=c[0][0],i=s,a=c[0][1],r=a;c.forEach(([e,t])=>{(void 0===s||e<s)&&(s=e),(void 0===a||t<a)&&(a=t),(void 0===i||e>i)&&(i=e),(void 0===r||t>r)&&(r=t)});const l=document.createElement("canvas");l.width=i-s+1,l.height=r-a+1;const h=l.getContext("2d");h.fillStyle=m.pen.color,c.forEach(([e,t])=>h.fillRect(e-s,t-a,1,1));const d=e.getRelativeCoord(s,a),u=Math.round((i-s)/e.scale),b=Math.round((r-a)/e.scale),v=new Re(l,d.x,d.y,u,b,-e.rotation);p.add(v)})},Te=function(e){Me(e),Be(e),Le(e)};const Xe={class:"page-wrap flex-v"},Ye={key:0},qe={class:"drawer-wrap"};var $e=Object(o["defineComponent"])({__name:"index",setup(e){const t=Object(o["ref"])(),n=Object(o["ref"])(),c=()=>{n.value=null};let s=null;const i=()=>{u.drawFrame(),s=window.requestAnimationFrame(i)};return Object(o["provide"])("openDrawer",e=>n.value=Object(o["markRaw"])(e)),Object(o["provide"])("closeDrawer",c),Object(o["provide"])("cvs",u),Object(o["provide"])("setting",m),Object(o["provide"])("memo",p),Object(o["onMounted"])(()=>{u.mount(t.value),Te(u),i()}),Object(o["onBeforeMount"])(()=>{s&&window.cancelAnimationFrame(s)}),(e,s)=>(Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],null,[Object(o["createElementVNode"])("div",Xe,[Object(o["createVNode"])(Ce,{class:"flex-item",onGesturestart:s[0]||(s[0]=Object(o["withModifiers"])(()=>{},["prevent"]))}),Object(o["createElementVNode"])("div",{ref_key:"cvsWrap",ref:t,class:"flex-main"},null,512)]),Object(o["createVNode"])(o["Transition"],{name:"drawer"},{default:Object(o["withCtx"])(()=>[n.value?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Ye,[Object(o["createElementVNode"])("div",{class:"modal",onClick:c}),Object(o["createElementVNode"])("div",qe,[Object(o["createElementVNode"])("span",{class:"closeicon iconfont icon-halfscreen",onClick:c}),(Object(o["openBlock"])(),Object(o["createBlock"])(Object(o["resolveDynamicComponent"])(n.value)))])])):Object(o["createCommentVNode"])("",!0)]),_:1})],64))}});n("837c"),n("b21f");const Je=_()($e,[["__scopeId","data-v-8cf3083e"]]);t["default"]=Je},"837c":function(e,t,n){"use strict";n("c665")},"889d":function(e,t,n){},"89e2":function(e,t,n){},"8d23":function(e,t,n){},"920e":function(e,t,n){"use strict";n("fda6")},"9ce1":function(e,t,n){"use strict";n("8d23")},a720:function(e,t,n){"use strict";n("89e2")},b21f:function(e,t,n){"use strict";n("889d")},c665:function(e,t,n){},d227:function(e,t,n){},fda6:function(e,t,n){}}]);
//# sourceMappingURL=home.6be6437d.js.map